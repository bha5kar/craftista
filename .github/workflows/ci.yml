name: CI
on:
  push:
    branches:
      - main
  
  workflow_dispatch:

jobs:
  SonarQube:
    runs-on: self-hosted
    strategy:
      matrix:
        service: [catalogue,frontend,recommendation,voting]
    steps:
      
      - name: checkout repo
        uses: actions/checkout@v4
      
      - name: Install SonarQube Scanner CLI
        run: |
          curl -sSLo sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip
          unzip sonar-scanner.zip
          mv sonar-scanner-* sonar-scanner
          echo "$(pwd)/sonar-scanner/bin" >> $GITHUB_PATH
          pwd

      - name: Scan ${{ matrix.service }}
        working-directory: ${{ matrix.service }}
        run: |
          sonar-scanner \
          -Dsonar.projectKey=${{ matrix.service }} \
          -Dsonar.sources=/home/bha5kar/workspace/actions-runner/_work/craftista/craftista/${{ matrix.service }} \
          -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }} \
          -Dsonar.login=${{ secrets.SONAR_TOKEN }}

      # - name: Scan Frontend
      #   working-directory: frontend
      #   run: |
      #     sonar-scanner \
      #     -Dsonar.projectKey=frontend \
      #     -Dsonar.sources=/home/bha5kar/workspace/actions-runner/_work/craftista/craftista/frontend \
      #     -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }} \
      #     -Dsonar.login=${{ secrets.SONAR_TOKEN }}

